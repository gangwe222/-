local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Event = ReplicatedStorage:WaitForChild("ASISU1")

local running = false
local loopThread

local function shuffle(tbl)
	local newTbl = {}
	for i, v in ipairs(tbl) do
		newTbl[i] = v
	end
	for i = #newTbl, 2, -1 do
		local j = math.random(1, i)
		newTbl[i], newTbl[j] = newTbl[j], newTbl[i]
	end
	return newTbl
end

local function startLoop()
	if loopThread then return end -- ì¤‘ë³µ ë°©ì§€
	loopThread = task.spawn(function()
		while running do
			local success, err = pcall(function()
				local players = Players:GetPlayers()
				local shuffled = shuffle(players)

				for _, player in ipairs(shuffled) do
					if not running then break end

					-- ì´ë²¤íŠ¸ í˜¸ì¶œ ì‹œ pcallë¡œ ì—ëŸ¬ ë°©ì§€
					pcall(function()
						Event:FireServer(player.Name, -9e50)
					end)
					task.wait(0.01)
				end
			end)
			
			if not success then
				warn("ë°˜ë³µ ëˆ í…ŒëŸ¬ ì—ëŸ¬ ë°œìƒ: ", err)
			end

			task.wait(0.35)
		end
		loopThread = nil
	end)
end

MainTab:CreateToggle({
	Name = "ğŸ’£ ë°˜ë³µ ëˆ í…ŒëŸ¬ (0.35ì´ˆ)",
	CurrentValue = false,
	Flag = "ë°˜ë³µ_ëˆ_í…ŒëŸ¬_í† ê¸€", -- Rayfield Flag (ì˜µì…˜)
	Callback = function(Value)
		running = Value
		if running then
			startLoop()
		end
	end
})
