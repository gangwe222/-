local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Event = ReplicatedStorage:WaitForChild("ASISU1")

local running = false
local loopThread

local function shuffle(tbl)
	local newTbl = {}
	for i, v in ipairs(tbl) do
		newTbl[i] = v
	end
	for i = #newTbl, 2, -1 do
		local j = math.random(1, i)
		newTbl[i], newTbl[j] = newTbl[j], newTbl[i]
	end
	return newTbl
end

local function startLoop()
	if loopThread then return end -- 중복 방지
	loopThread = task.spawn(function()
		while running do
			local success, err = pcall(function()
				local players = Players:GetPlayers()
				local shuffled = shuffle(players)

				for _, player in ipairs(shuffled) do
					if not running then break end

					-- 이벤트 호출 시 pcall로 에러 방지
					pcall(function()
						Event:FireServer(player.Name, -9e50)
					end)
					task.wait(0.01)
				end
			end)
			
			if not success then
				warn("반복 돈 테러 에러 발생: ", err)
			end

			task.wait(0.35)
		end
		loopThread = nil
	end)
end

MainTab:CreateToggle({
	Name = "💣 반복 돈 테러 (0.35초)",
	CurrentValue = false,
	Flag = "반복_돈_테러_토글", -- Rayfield Flag (옵션)
	Callback = function(Value)
		running = Value
		if running then
			startLoop()
		end
	end
})
